<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
		<meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge,IE=11,IE=10,IE=9,IE=8"/>
		<meta http-equiv="expires" content="0" /> 
		<meta http-equiv="Pragma" content="no-cache" />
		
		<title>众联云海后台管理系统</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/bootstrap/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">-->
		<link rel="stylesheet" href="__PUBLIC__/plugins/font-awesome/css/font-awesome.css">
			
		<!-- Ionicons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/skins/_all-skins.min.css">
			
		<style type="text/css">
			.img_box{
				background: #EEEEEE;
				position: relative;
				height: 150px;
			}
			.img_box>div{
				height: 100%;
				position: relative;
			}
			.img_box>div>img{
				position: absolute;
				max-width: 100%;
				max-height: 100%;
				top: 0px;
				bottom: 0px;
				left: 0px;
				right: 0px;
				margin: auto;
			}
			.img_box>span{
				position: absolute;
				top: 0px;
				right: 0px;
				padding: 3px 5px;
				font-size: 12px;
				color: #FFFFFF;
				background: #ef5c5c;
				display: none;
				z-index: 1;
				cursor: pointer;
			}
			.img_box:hover>span{
				display: block;
			}
			.img_box>span:hover{
				background: red;
			}
			.file_box{
				display: none;
			}
			
		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">
			
			<!--引入导航-->
			{include file="index::Navigation" /}
			
			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header">
					<h1>
						常规设置
				   	</h1>
					<ol class="breadcrumb">
				        <li><a href="javascript:;"><i class="fa fa-dashboard"></i>基本信息</a></li>
				        <li class="active">常规设置</li>
				    </ol>
				</section>
				
				<!--内容-->
				<section class="content">
					<div class="box">
						<div class="box-body">
							<form class="form">
								<div class="row" style="min-height: 500px;">
									<div class="form-group col-lg-4">
					                  	<label for="exampleInputEmail1">主LOGO</label>
					                  	<div class="img_box">
					                  		{if condition="$obj.mainLogo.val!=''"}
					                  		<span>删除</span>
					                  		{/if}
					                  		<div class="mainLogo">
					                  			{if condition="$obj.mainLogo.val!=''"}
					                  			<img data-src="{$obj.mainLogo.val}" src="__UPLOAD__/{$obj.mainLogo.val}"/>
					                  			{/if}
					                  		</div>
					                  	</div>
					                  	<div class="file_box">
											<input type="file" accept="image/*" name="mainLogo" id="" value="" />
										</div>
					                </div>
					                <div class="form-group col-lg-4">
					                  	<label for="exampleInputEmail1">附LOGO</label>
					                  	<div class="img_box">
					                  		{if condition="$obj.attachLogo.val!=''"}
					                  		<span>删除</span>
					                  		{/if}
					                  		<div class="attachLogo">
					                  			{if condition="$obj.attachLogo.val!=''"}
					                  			<img data-src="{$obj.attachLogo.val}" src="__UPLOAD__/{$obj.attachLogo.val}"/>
					                  			{/if}
					                  		</div>
					                  	</div>
					                  	<div class="file_box">
											<input type="file" accept="image/*" name="attachLogo" id="" value="" />
										</div>
					                </div>
					                <div class="form-group col-lg-4">
					                  	<label for="exampleInputEmail1">公司二维码</label>
					                  	<div class="img_box">
					                  		{if condition="$obj.QrCode.val!=''"}
					                  		<span>删除</span>
					                  		{/if}
					                  		<div class="QrCode">
					                  			{if condition="$obj.QrCode.val!=''"}
					                  			<img data-src="{$obj.QrCode.val}" src="__UPLOAD__/{$obj.QrCode.val}"/>
					                  			{/if}
					                  		</div>
					                  	</div>
					                  	<div class="file_box">
											<input type="file" accept="image/*" name="QrCode" id="" value="" />
										</div>
					                </div>
									<div class="form-group col-md-6 col-lg-4">
					                  	<label>站点标题</label>
					                  	<input type="text" class="form-control" name="WebsiteTitle" value="{$obj.WebsiteTitle.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label>副标题</label>
					                  	<input type="text" class="form-control" name="Subtitle" value="{$obj.Subtitle.val}"/>
					                </div>
					                
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">网站关键字（keywords）</label>
					                  	<input type="text" class="form-control" name="keywords" value="{$obj.keywords.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">网站描述（description）</label>
					                  	<input type="text" class="form-control" name="description" value="{$obj.description.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">联系电话</label>
					                  	<input type="text" class="form-control" name="Telephone" value="{$obj.Telephone.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">QQ</label>
					                  	<input type="text" class="form-control" name="QQ" value="{$obj.QQ.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">ICP 备案</label>
					                  	<input type="text" class="form-control" name="ICP" value="{$obj.ICP.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">邮箱</label>
					                  	<input type="text" class="form-control" name="mailbox" value="{$obj.mailbox.val}"/>
					                </div>
					                <div class="form-group col-md-6 col-lg-4">
					                  	<label for="exampleInputEmail1">联系地址</label>
					                  	<input type="text" class="form-control" name="address" value="{$obj.address.val}"/>
					                </div>
					                <div class="form-group col-lg-12">
					                	<label for="">企业概括</label>
					                	<div contenteditable="true" class="Culture form-control" style="height: auto;min-height: 150px;">{$obj.Culture.val}</div>
					                	<!--<textarea name="Culture" style="min-width: 100%;max-width: 100%;min-height: 150px;" class="form-control" >{$obj.Culture.val}</textarea>-->
					                </div>
								</div>
								<div class="row">
									<div class="col-lg-12">
										<button type="button" class="Submit_1 btn btn-block btn-default">保存</button>
									</div>
								</div>
							</form>
						</div>
					</div>
				</section>
				<!-- /.content -->
			</div>
			
			{include file="index::footer" /}
			<div class="control-sidebar-bg"></div>
		</div>
		<!-- ./wrapper -->
		
		
		
		<div class="modal fade" id="Prompt" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		    <div class="modal-dialog">
		        <div class="modal-content">
		            <div class="modal-header">
		                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
		                <h4 class="modal-title" id="myModalLabel">提示</h4>
		            </div>
		            <div class="modal-body Prompt"></div>
		            <!--<div class="modal-footer">
		                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
		                <button type="button" class="DetermineDel btn btn-primary">确定</button>
		            </div>-->
		        </div><!-- /.modal-content -->
		    </div><!-- /.modal -->
		</div>
		
		<!--详情和添加框-->
		<div class="details_box">
			
			
		</div>
		
		
		
		<!-- jQuery 2.2.3 -->
		<!-- jQuery UI 1.11.4 -->
		<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
		<!-- Resolve conflict in jQuery UI tooltip with Bootstrap tooltip -->
		<script>
			$.widget.bridge('uibutton', $.ui.button);
		</script>
		<!-- Bootstrap 3.3.6 -->
		<script src="__PUBLIC__/plugins/bootstrap/js/bootstrap.min.js"></script>
		
		<!-- AdminLTE App -->
		<script src="__PUBLIC__/plugins/dist/js/app.min.js"></script>
		<script src="__PUBLIC__/plugins/vue/vue.js"></script>
		<script type="text/javascript">
			
			function ajax_post(u,d,f){
				$.ajax({
					type:"post",
					url:u,
					data:d,
					async:true,
					success:function(x){
						f(x)
					}
				});
			}
			//选择图片
			$('.img_box').children('div').click(function(){
				$(this).parent().next().children().click();
			})
			$('.file_box').on('change','input',function(){
				var this_1=$(this);
				var file01=$(this)[0].files[0];
				if(!file01) return;
				var type=file01.type.substring(0,file01.type.indexOf('/'));
				if(type!='image'){
						
				}else{
					files=new FileReader();
					files.readAsDataURL(file01)
					files.onload=function(e){
						var fil01 = e.target.result;
						var pos = fil01.indexOf("4") + 2;
						this_1.parent().prev().append('<span>删除</span>');
						this_1.parent().prev().children('div').html('<img src="'+fil01+'"/>')
//						img.attr('src',fil01);
					}
				}
			})
			//删除图片
			$('.img_box').on('click','span',function(){
				$(this).siblings().children().remove();
				var inputFile=$(this).parent().next().children().attr('name');
				$(this).parent().next().html('<input type="file" accept="image/*" name="'+inputFile+'" id="" value="" />')
				$(this).remove();
			})
			
			$('.Submit_1').click(function(){
				
				var formData = new FormData($('.form')[0]);
					formData.append('mainLogo_src',$('.mainLogo').children().attr('data-src') ? $('.mainLogo').children().attr('data-src') :'');
					formData.append('attachLogo_src',$('.attachLogo').children().attr('data-src') ? $('.attachLogo').children().attr('data-src') :'');
					formData.append('QrCode_src',$('.QrCode').children().attr('data-src') ? $('.QrCode').children().attr('data-src') :'');
					formData.append('Culture',$('.Culture').html())
					
//				$('.file_box').each(function(){
//					var file01=$(this).children()[0].files[0];
//					var name=$(this).children().attr('name');
//					formData.append(name,file01);
//				})
				
				$.ajax({   
					type: "POST",
					url: "{:url('admin/post/basic')}",
					data: formData,
					processData: false,
					//必须false才会自动加上正确的Content-Type
					contentType: false,
//					xhr: function() {    
//						var xhr = $.ajaxSettings.xhr();
//						if(onprogress && xhr.upload) {  
//							xhr.upload.addEventListener("progress", onprogress, false);
//							return xhr; 
//						}
//					}, 
					success:function(data){
						console.log(data)
						if(isNaN(data)){
							$('.Prompt').html('设置失败！请联系管理员');
							$('#Prompt').modal('show');
						}else{
							$('.Prompt').html('设置成功');
							$('#Prompt').modal('show');
						}
					}
				}); 
			})	
			
			function onprogress(evt) {
				var loaded = evt.loaded;     //已经上传大小情况 
				var tot = evt.total;      //附件总大小 
				var per = Math.floor(100 * loaded / tot);  //已经上传的百分比 
				$(".progress_1").css("width", per + "%"); 
			}
			
			
			
			
			
			
			
			
			
			function formatDate (date, fmt) {
				if (/(y+)/.test(fmt)) {
				    fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length))
				}
				let o = {
				    'M+': date.getMonth() + 1,
				    'd+': date.getDate(),
				    'h+': date.getHours(),
				    'm+': date.getMinutes(),
				    's+': date.getSeconds()
				}
				for (let k in o) {
				  	if (new RegExp(`(${k})`).test(fmt)) {
				      	let str = o[k] + ''
				      	fmt = fmt.replace(RegExp.$1, (RegExp.$1.length === 1) ? str : padLeftZero(str))
				    }
				}
				return fmt
			}
			function padLeftZero (str) {
				return ('00' + str).substr(str.length)
			}
			
		</script>
	</body>
</html>