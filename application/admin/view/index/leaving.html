<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
		<meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge,IE=11,IE=10,IE=9,IE=8"/>
		<meta http-equiv="expires" content="0" /> 
		<meta http-equiv="Pragma" content="no-cache" />
		
		<title>众联云海后台管理系统</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/bootstrap/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">-->
		<link rel="stylesheet" href="__PUBLIC__/plugins/font-awesome/css/font-awesome.css">
			
		<!-- Ionicons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/skins/_all-skins.min.css">
			
		<style type="text/css">
			.table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
				vertical-align: middle;
			}
			.img{
				width: 50px;
				height: 50px;
				position: relative;
				background: #EEEEEE;
			}
			.img>img{
				max-height: 100%;
				max-width: 100%;
				position: absolute;
				top: 0px;
				bottom: 0px;
				left: 0px;
				right: 0px;
				margin: auto;
			}
			
			/*详情图片*/
			.detailsImg{
				height: 300px;
				background: #EEEEEE;
				position: relative;
			}
			.detailsImg>img{
				max-height: 100%;
				max-width: 100%;
				position: absolute;
				top: 0px;
				bottom: 0px;
				left: 0px;
				right: 0px;
				margin: auto;
			}
			.detailsImg:empty:after{
				width: 238px;
			    height: 50px;
			    content: '点击选择图片';
			    font-size: 38px;
			    position: absolute;
			    top: 0px;
			    left: 0px;
			    bottom: 0px;
			    right: 0px;
			    margin: auto;
			    color: #9c9c9c;
			}
			
			.text_box{
				max-width: 100%;
			}
			.text_box>div{
				overflow: hidden;
				text-overflow: ellipsis;
				max-height: 20px;
				-webkit-transition: all 1s;
				-moz-transition: all 1s;
				-ms-transition: all 1s;
				-o-transition: all 1s;
				transition: all 1s;
				cursor: pointer;
			}
			/*.text_box{
				max-height: 500px;
				height: auto;
				overflow: auto;
				white-space: normal;
			}*/
			ul{
				margin: 0px;
				padding: 0px;
			}
			li{
				list-style: none;
			}
			.box_1{
				overflow: auto;
				border-top: 1px solid #EEEEEE;
				border-right: 1px solid #EEEEEE;
			}
			.box_1>li{
				min-width: 850px;
				border-bottom: 1px solid #EEEEEE;
				min-height: 32px;
				position: relative;
				cursor: pointer;
			}
			.box_1>li:nth-child(1){
				font-weight: bold;
				background: #EEEEEE;
			}
			.box_1>li:hover{
				background: #EEEEEE;
			}
			.box_1>li>div{
				padding: 5px;
				min-height: 32px;
				height: 100%;
				border-left: 1px solid #EEEEEE;
			}
			.box_1 .name_1,
			.box_1 .Telephone,
			.box_1 .time_1,
			.box_1 .operation{
				position: absolute;
				top: 0px;
			}
			.box_1 .name_1{
				width: 200px;
				left: 0px;
			}
			.box_1 .Telephone{
				width: 150px;
				left: 200px;
			}
			.box_1 .time_1{
				width: 200px;
				right: 80px;
			}
			.box_1 .operation{
				width: 80px;
				right: 0px;
			}
			
			.box_1 .text_1{
				margin: 0px 280px 0px 350px;
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				height: 32px;
			}
			.box_1 .text_1.active{
				white-space: normal;
				height: auto;
			}
			
		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">
			
			<!--引入导航-->
			{include file="index::Navigation" /}
			
			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header">
					<h1>
						用户留言
				   	</h1>
					<ol class="breadcrumb">
				        <li><a href="javascript:;"><i class="fa fa-dashboard"></i>用户留言</a></li>
				    </ol>
				</section>
				
				<!--内容-->
				<section class="content">
					<div class="box">
						<div class="box-header">
							<div class="box-title"></div>
							<div class="box-tools">
								<div class="input-group input-group-sm" style="width: 200px;">
				                  	<input type="text" v-model="screen" class="form-control pull-right" placeholder="按标题查询" />
				                  	<div class="input-group-btn">
				                    	<button type="button" v-on:click="changeScreen()" class="btn btn-default"><i class="fa fa-search"></i></button>
				                  	</div>
				                </div>
							</div>
						</div>
						<div class="box-body" style="min-height: 300px;">
							<ul class="box_1">
								<li>
									<div class="name_1">姓名</div>
									<div class="Telephone">电话</div>
									<div class="text_1">留言内容</div>
									<div class="time_1">留言时间</div>
									<div class="operation">操作</div>
								</li>
								<li v-for="x in list">
									<div class="name_1">
										<i v-show="x.isRead==0" class="glyphicon glyphicon-exclamation-sign text-red"></i>
										{{x.name}}
									</div>
									<div class="Telephone">{{x.Telephone}}</div>
									<div class="text_1">{{x.text}}</div>
									<div class="time_1">{{x.time}}</div>
									<div class="operation">
										<button v-on:click="remove(x)" class="btn btn-danger btn-xs"><i class="glyphicon glyphicon-remove"></i></button>
									</div>
								</li>
							</ul>
						</div>
						
						<div class="box-footer" v-if="pageIng.page.length>1">
			              	<ul class="pagination pagination-sm no-margin pull-right">
			                	<li v-on:click="changPage(pageIng.upper)"><a href="javascript:;">«</a></li>
			                	<li v-on:click="changPage(x)" v-bind:class="{'active':x==pageIndex}" v-for="x in pageIng.page"><a href="javascript:;">{{x}}</a></li>
			                	<li v-on:click="changPage(pageIng.lower)"><a href="javascript:;">»</a></li>
			              	</ul>
			           </div>
					</div>
					
					
					<!--提示-->
					<div class="modal fade" id="Prompt" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					    <div class="modal-dialog">
					        <div class="modal-content">
					            <div class="modal-header">
					                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					                <h4 class="modal-title" id="myModalLabel">提示</h4>
					            </div>
					            <div class="modal-body">{{Prompt}}</div>
					            <!--<div class="modal-footer">
					                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					                <button type="button" class="DetermineDel btn btn-primary">确定</button>
					            </div>-->
					        </div><!-- /.modal-content -->
					    </div><!-- /.modal -->
					</div>
					
					<div class="modal fade" id="Delete" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					    <div class="modal-dialog">
					        <div class="modal-content">
					            <div class="modal-header">
					                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					                <h4 class="modal-title" id="myModalLabel">提示</h4>
					            </div>
					            <div class="modal-body">确定删除？</div>
					            <div class="modal-footer">
					                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					                <button type="button" v-on:click="Determine()" class="btn btn-primary">确定</button>
					            </div>
					        </div><!-- /.modal-content -->
					    </div><!-- /.modal -->
					</div>
					
					
				</section>
				<!-- /.content -->
			</div>
			
			{include file="index::footer" /}
			
			<div class="file hidden">
				<input type="file" accept="image/*" name="" id="" value="" />
			</div>

			
			<div class="control-sidebar-bg"></div>
		</div>
		<!-- ./wrapper -->
		
		
		<!-- jQuery 2.2.3 -->
		<!-- jQuery UI 1.11.4 -->
		<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>

		<script src="__PUBLIC__/plugins/bootstrap/js/bootstrap.min.js"></script>
		
		<script src="__PUBLIC__/plugins/dist/js/app.min.js"></script>
		<script src="__PUBLIC__/plugins/vue/vue.js"></script>
		<script type="text/javascript">
			
			function ajax_post(u,d,f){
				$.ajax({
					type:"post",
					url:u,
					data:d,
					async:true,
					success:function(x){
						f(x)
					}
				});
			}
			var content=new Vue({
					el:'.content',
					data:{
						list:[],
						pageIng:{"upper":"","page":[],"lower":""},
						pageIndex:1,
						pageSize:10,
						Prompt:'',
						screen:'',
						DeleteObj:''
					},
					methods:{
						changPage:function(x){		//翻页
							if(x!=''){
								this.pageIndex=x;
								getLeaving();
							}
						},
						remove:function(x){			//点击删除按钮
							this.DeleteObj=x;
							$('#Delete').modal('show');
						},
						Determine:function(){		//确定删除
							var obj=new Object();
								obj.Id=this.DeleteObj.Id;
								$('#Delete').modal('hide');
							ajax_post('{:url("admin/post/deleteLeaving")}',obj,delR)
						}
					}
				});
				
				function delR(){
					getLeaving()
				}
				
				//点击展开详情
				$('.box_1').on('click','.text_1',function(){
					if($(this).is('.active')){
						$(this).removeClass('active')
					}else{
						$(this).addClass('active')
					}					
				})
				//标记已读
				$('.box_1').on('click','li',function(){
					var index=$(this).index()-1;
					var obj=content.list[index];
					content.list[index].isRead=1
					ajax_post('{:url("admin/post/updateLaevingIsRead")}',obj,updateR)
					console.log(obj)
				})
				function updateR(){
					ajax_post('{:url("admin/post/getLeavingCount")}','',getLeavingCount)
//					$('.leavingIsRead')
				}
				function getLeavingCount(x){
					console.log(x)
					if(x==0){
						$('.leavingIsRead').remove();
					}else{
						$('.leavingIsRead').children().html(x)
					}
				}
				
				function getLeaving(){
					var obj=new Object();
						obj.screen=content.screen;
						obj.pageIndex=content.pageIndex;
						obj.pageSize=content.pageSize;
					ajax_post('{:url("admin/post/getLeaving")}',obj,getR)
				}
				getLeaving()
				function getR(x){
					var x=JSON.parse(x);
					console.log(x)
					content.list=x.list
					content.pageIng=x.pageIng
				}
			
				
			
			
		</script>
	</body>
</html>