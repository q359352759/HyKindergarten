<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"/>
		<meta http-equiv="X-UA-Compatible" content="chrome=1,IE=edge,IE=11,IE=10,IE=9,IE=8"/>
		<meta http-equiv="expires" content="0" /> 
		<meta http-equiv="Pragma" content="no-cache" />
		
		<title>众联云海后台管理系统</title>
		<!-- Tell the browser to be responsive to screen width -->
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<!-- Bootstrap 3.3.6 -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/bootstrap/css/bootstrap.min.css">
		<!-- Font Awesome -->
		<!--<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.5.0/css/font-awesome.min.css">-->
		<link rel="stylesheet" href="__PUBLIC__/plugins/font-awesome/css/font-awesome.css">
			
		<!-- Ionicons -->
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/ionicons/2.0.1/css/ionicons.min.css">
		<!-- Theme style -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/iCheck/all.css">
		
		<link rel="stylesheet" href="__PUBLIC__/plugins/select2/select2.min.css">
		<!--时间-->
		<link rel="stylesheet" type="text/css" href="__PUBLIC__/plugins/bootstrap-datetimepicker-master/css/bootstrap-datetimepicker.css"/>
		
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/AdminLTE.min.css">
		<!-- AdminLTE Skins. Choose a skin from the css/skins
       folder instead of downloading all of them to reduce the load. -->
		<link rel="stylesheet" href="__PUBLIC__/plugins/dist/css/skins/_all-skins.min.css">
		
			
		<style type="text/css">
			.table>tbody>tr>td, .table>tbody>tr>th, .table>tfoot>tr>td, .table>tfoot>tr>th, .table>thead>tr>td, .table>thead>tr>th{
				vertical-align: middle;
			}
			.img{
				height: 150px;
				position: relative;
				background: #EEEEEE;
			}
			.img>img{
				max-height: 100%;
				max-width: 100%;
				position: absolute;
				top: 0px;
				bottom: 0px;
				left: 0px;
				right: 0px;
				margin: auto;
			}
			
			
			
		</style>

		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
  <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
  <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]-->
	</head>

	<body class="hold-transition skin-blue sidebar-mini">
		<div class="wrapper">
			
			<!--引入导航-->
			{include file="index::Navigation" /}
			
			<!-- Content Wrapper. Contains page content -->
			<div class="content-wrapper">
				<!-- Content Header (Page header) -->
				<section class="content-header">
					<h1>
						{if condition="isset($details.Id)"}
							{$typeNme[$type]}详情
							{else /}
							添加{$typeNme[$type]}
						{/if}
				   	</h1>
					<ol class="breadcrumb">
				        <li><a href="javascript:;"><i class="fa fa-dashboard"></i>{$typeNme[$type]}</a></li>
				    </ol>
				</section>
				
				<!--内容-->
				<section class="content">
					<form class="form_1">
						<div class="row">
							<div class="col-lg-4">
								<div class="box">
									<div class="box-body" style="min-height: 300px;">
										<input type="text" class="thisId hidden" name="" id="" value="{$details.Id ?? ''}" />
										<div class="form-group">
											<label>作者/姓名</label>
											<input type="text" class="form-control author" name="" id="" value="{$details.author ?? ''}" />
										</div>
										
										<div class="form-group {$type==3 ? '' :'hidden'}">
											<label>年龄</label>
											<input type="text" max="50" pattern=".*[^ ].*" class="form-control Age" name="" value="{$details.Age ?? ''}"  />
										</div>
										<div class="form-group {$type==3 ? '' :'hidden'}">
											<label>班级</label>
											<input type="text" max="50" pattern=".*[^ ].*" class="form-control class" name="" value="{$details.class ?? ''}"  />
										</div>
										
										<div class="form-group">
											<label>标题</label>
											<input type="text" max="50" required="" pattern=".*[^ ].*" class="form-control title" name="" value="{$details.title ?? ''}"  />
										</div>
										<div class="form-group">
											<label>简介</label>
											<textarea class="form-control introduce" name="" rows="" cols="">{$details.introduce ?? ''}</textarea>
										</div>
										<div class="form-group">
											<label for="">所属园区</label>
											<select name="" class="school form-control"  multiple="multiple">
												{volist name="schoolList" id="typeObj"}
													{if condition="isset($typeObj.schoolselected)"}
														<option selected="" value="{$typeObj.Id}">{$typeObj.name}</option>
														{else /}
														<option value="{$typeObj.Id}">{$typeObj.name}</option>
													{/if}
												{/volist}
											</select>
										</div>
										<div class="form-group {$type==1 ? 'hidden' :''}">
											<label for="">类型/所属</label>
											<select name="" class="type_1 form-control"  multiple="multiple">
												{volist name="typeList" id="typeObj"}
													{if condition="isset($typeObj.selected)"}
														<option selected="" value="{$typeObj.Id}">{$typeObj.name}</option>
														{else /}
														<option value="{$typeObj.Id}">{$typeObj.name}</option>
													{/if}
												{/volist}
											</select>
										</div>
										<div class="form-group">
											<label>排序</label>
											<input type="number" min="0" class="form-control sort" name="" id="" value="{$details.sort ?? ''}" />
										</div>
										<div class="form-group">
											<label for="">创建时间</label>
											<input type="text" class="form-control CreationTime" name="" id="" value="{$details.CreationTime ?? ''}" />
										</div>
										<div class="form-group">
											<label for="">封面图</label>
											<div class="img">
												{if condition="isset($details.CoverMap)"}
												<img img-data="{$details.CoverMap}" src="__UPLOAD__/{$details.CoverMap}"/>
												{/if}
											</div>
											<div class="file hidden">
												<input type="file" accept="image/*" name="" id="" value="" />
											</div>
										</div>
									</div>
								</div>
							</div>
							<div class="col-lg-8">
								<div class="box">
									<div class="box-body">
										<div class="form-group">
											<label for="">内容</label>
											<!--<input type="text" id='editor1' class="form-control text" name="" id="" value="" />-->
											<textarea name="" rows="" id="editor1" class="text" cols="">{$details.text ?? ''}</textarea>
										</div>
									</div>
									<div class="box-footer">
										<button type="submit" class="btn btn-block btn-info">保存</button>
									</div>
								</div>
							</div>
						</div>
					</form>
					
					
					<!--提示-->
					<div class="modal fade" id="Prompt" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
					    <div class="modal-dialog">
					        <div class="modal-content">
					            <div class="modal-header">
					                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
					                <h4 class="modal-title" id="myModalLabel">提示</h4>
					            </div>
					            <div class="modal-body Prompt"></div>
					            <!--<div class="modal-footer">
					                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					                <button type="button" class="DetermineDel btn btn-primary">确定</button>
					            </div>-->
					        </div><!-- /.modal-content -->
					    </div><!-- /.modal -->
					</div>
					
					
				</section>
				<!-- /.content -->
			</div>
			
			{include file="index::footer" /}
			
			<div class="control-sidebar-bg"></div>
		</div>
		<!-- ./wrapper -->
		
		<!-- jQuery 2.2.3 -->
		<!-- jQuery UI 1.11.4 -->
		<script src="https://code.jquery.com/ui/1.11.4/jquery-ui.min.js"></script>
		<script src="__PUBLIC__/plugins/bootstrap/js/bootstrap.min.js"></script>
		
		<script src="__PUBLIC__/plugins/select2/select2.full.min.js"></script>
		<script src="__PUBLIC__/plugins/iCheck/icheck.min.js"></script>
		
		<script src="__PUBLIC__/plugins/dist/js/app.min.js"></script>
		<!--百度富文本-->
		<script type="text/javascript" charset="utf-8" src="__PUBLIC__/plugins/ueditor/ueditor.config.js"></script>
		<script type="text/javascript" charset="utf-8" src="__PUBLIC__/plugins/ueditor/ueditor.all.js"></script>
		<!--kindeditor 富文本-->
		<script src="__PUBLIC__/plugins/kindeditor-4.1.7/kindeditor-all.js" type="text/javascript" charset="utf-8"></script>
		<!--时间-->
		<script src="__PUBLIC__/plugins/bootstrap-datetimepicker-master/js/bootstrap-datetimepicker.js" type="text/javascript" charset="utf-8"></script>

		<!--<script src="__PUBLIC__/plugins/vue/vue.js"></script>-->
		<script type="text/javascript">
			//iCheck for checkbox and radio inputs
		    $('input[type="checkbox"].minimal, input[type="radio"].minimal').iCheck({
		      checkboxClass: 'icheckbox_minimal-blue',
		      radioClass: 'iradio_minimal-blue'
		    });
		    //Red color scheme for iCheck
		    $('input[type="checkbox"].minimal-red, input[type="radio"].minimal-red').iCheck({
		      checkboxClass: 'icheckbox_minimal-red',
		      radioClass: 'iradio_minimal-red'
		    });
		    //Flat red color scheme for iCheck
		    $('input[type="checkbox"].flat-red, input[type="radio"].flat-red').iCheck({
		      checkboxClass: 'icheckbox_flat-green',
		      radioClass: 'iradio_flat-green'
		    });
		</script>
		<script type="text/javascript">
			
			function ajax_post(u,d,f){
				$.ajax({
					type:"post",
					url:u,
					data:d,
					async:true,
					success:function(x){
						f(x)
					}
				});
			}
			var type='{$type}';
			
			$('.type_1').select2()
			$('.school').select2()
			KindEditor.ready(function(K) {
		        window.editor = K.create('#editor1',{
		        	width:'100%',
		        	height:"{$type==0 ? '480px' : '620px'}",
		        	resizeType:1
		        	//resizeType 2或1或0，2时可以拖动改变宽度和高度，1时只能改变高度，0时不能拖动。  数据类型: Int  默认值: 2
		        });
		   	});
		   	 //百度输入框
//			var ue = UE.getEditor('editor1',{
//		       	initialFrameHeight:500
//		    });

			$('.CreationTime').datetimepicker({
				language: 'zh-CN',
				format:'yyyy-mm-dd hh:mm',
		//		startView:4,
		//		minView:4,
				autoclose: 1
			});
			
			//点击选择图片
			$('.img').click(function(){
				$('.file').html('<input type="file" accept="image/*" name="" id="" value="" />');
				$('.file').children().click();
			})
			//选择图片
			var base64='';
			$('.file').on('change','input',function(){
				var this_1=$(this);
				var file01=$(this)[0].files[0];
				if(!file01) return;
				var type=file01.type.substring(0,file01.type.indexOf('/'));
				if(type!='image'){
						
				}else{
					files=new FileReader();
					files.readAsDataURL(file01)
					files.onload=function(e){
						var fil01 = e.target.result;
						var pos = fil01.indexOf("4") + 2;
						base64=fil01;
						$('.img').html('<img img-data="" src="'+fil01+'"/>');
					}
				}
			})
			
			$('.form_1').submit(function(){
				 editor.sync();				//这个让富文本可以查到内容
				var obj=new Object();
					obj.Id=$('.thisId').val();
					obj.type='{$type}';
					obj.TypeList=$('.type_1').val();
					obj.school=$('.school').val();
					obj.author=$('.author').val();
					obj.Age=$('.Age').val();
					obj.class=$('.class').val();
					obj.CoverMap=$('.img').children().attr('img-data') ? $('.img').children().attr('img-data') : '';
					obj.base64=base64;
					obj.title=$('.title').val();
					obj.introduce=$('.introduce').val();
					obj.text=$('.text').val();
					obj.sort=$('.sort').val();
					obj.CreationTime=$('.CreationTime').val();
					console.log(obj)
					{if condition="$type!=2"}
					if(obj.CoverMap=='' && obj.base64==''){
						$('.Prompt').html('请选择封面图')
						$('#Prompt').modal('show');
						return false;
					}
					{/if}
					ajax_post('{:url("admin/post/editPage")}',obj,editR);
				return false;
			})
			function editR(x){
				console.log(x)
				if(isNaN(x)){
					$('.Prompt').html('设置失败！请联系管理员！');
					$('#Prompt').modal('show');
				}else{
					window.history.back();
				}
			}
			
			console.log({:json_encode($details)})
			
		</script>
	</body>
</html>